PWD = $(shell pwd)
KERNEL_DIR = $(PWD)/../linux-5.10.1/

MODULE_NAME = demo
obj-m := $(MODULE_NAME).o

SRCS = $(filter-out $(MODULE_NAME).c, $(wildcard *.c))
EXPS = $(SRCS:.c=)
HOME = $(PWD)/../rootfs/home/nobodyQQ

all: exps ko

exps: $(EXPS)

$(EXPS):
	musl-gcc $@.c -o $(HOME)/$@ -static -masm=intel

ko:
	make -C $(KERNEL_DIR) M=$(PWD) modules

clean:
	make -C $(KERNEL_DIR) M=$(PWD) clean
	cd $(HOME) && rm $(EXPS)